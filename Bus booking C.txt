#include<stdio.h>
#include<conio.h>
#include<process.h>
void Addbus();
void listbus();
void bookti();
void listticket();
struct bus
{
	char bno[20];
	char atime[10];	
	char dtime[10];
	char from[10];
	char to[12];
	float fare;
	
}h;
struct tkt
{
	char busno[10];
	char pname[10];
	char age[10];
	float tktno;
	
}k;
void main()
{int ch;
printf("*******************************************************************************");
printf("\n*****Welcome to E-Bus ticket Booking*****\n");
printf("*******************************************************************************");

printf("\n1.Install\n2.Show Buses\n3.Book ticket\n4.To View Tickets\n5.Exit\nEnter your choice :");
scanf("%d",&ch);
switch(ch)
{
case 1:
	Addbus();
    break;
case 2:
	listbus();
    break;
case 3:
	bookti();
    break;
case 4:
    listticket();
	break;
case 5:
    exit(0);
}
getch();
}
void Addbus()
{
	FILE *p;
	p=fopen("addbus.txt","a+");
		printf("Enter Bus No. : ");
		fflush(stdin);
scanf("%s",&h.bno);
printf("Departure time : ");
fflush(stdin);
scanf("%s",&h.dtime);
printf("Arrival time : ");
fflush(stdin);
scanf("%s",&h.atime);
printf("From : ");
fflush(stdin);
scanf("%s",&h.from);
printf("To : ");
fflush(stdin);
scanf("%s",&h.to);

printf("Enter Fare :");
fflush(stdin);
scanf("%f",&h.fare);
fwrite(&h,sizeof(h),1,p);
fclose(p);
printf("Bus added successfully\n");
system("pause");
system("cls");
main();
	
}
void listbus()
{
 FILE *p;
 int i;
 if((p=fopen("addBus.txt","r"))==NULL)
  exit(0);
 system("cls");
 printf("Bus Number\tDeparture time\tArrival Time\tFrom\t To\tFare\n");

 while(fread(&h,sizeof(h),1,p)==1)
 {	
  printf("\n%s\t\t%s\t\t%s\t  %s\t %s\t\tRs. %f /-",h.bno,h.dtime,h.atime,h.from,h.to,h.fare);
 }
 printf("\n");
 

fclose(p);
getch();
main();
}

void bookti()
{FILE *p;
FILE *f;

f=fopen("addbus.txt","r+");
p=fopen("ticket.txt","a+");
	printf("enter bus no");
	fflush(stdin);
	scanf("%s",&k.busno);
	printf("enter passanger name");
		fflush(stdin);
	scanf("%s",&k.pname);
	printf("enter age");
		fflush(stdin);
	scanf("%s",&k.age);
	printf("Enter the Alloted Ticket Number");
	scanf("%f",&k.tktno);
	fwrite(&k,sizeof(k),1,p);
	printf("ticket booked successfully");
	 while(fread(&h,sizeof(h),1,f)==1)
 {	
  printf("\nFor Bus %s Fare is Rs%.2f /-",h.bno,h.fare);
 }
 printf("\n");
	fclose(p);
	system("pause");
	system("cls");
	getche();
	main();	
}

void listticket()
{
 FILE *f;
 int i;
 if((f=fopen("ticket.txt","r"))==NULL)
  exit(0);
 system("cls");
 printf("Bus Number\tPassenger Name\tAge\t    Ticket Number\n");
 while(fread(&k,sizeof(k),1,f)==1)
 {	
  printf("\n%s\t\t%s\t\t%s\t\t%f",k.busno,k.pname,k.age,k.tktno);
 }
 printf("\n");
 fclose(f);
getch();
system("cls");
main();
}

